$(document).foundation(),jQuery(document).ready(function(s){var t={config:{peak:{AM:[0,2],PM:[10,12],interval:5},usually:{times:[10,22],interval:10},notification:!1},anlycol:{Q3:{zu6:0,zu3:0,baozi:0},Z3:{zu6:0,zu3:0,baozi:0},H3:{zu6:0,zu3:0,baozi:0},Q2:{duizi:0,shun:0},H2:{duizi:0,shun:0},"__*":{count:0,_property_1:0,_property_2:0},__0:{count:0,_property_1:0,_property_2:0},__1:{count:0,_property_1:0,_property_2:0},__2:{count:0,_property_1:0,_property_2:0},__3:{count:0,_property_1:0,_property_2:0},__4:{count:0,_property_1:0,_property_2:0},__5:{count:0,_property_1:0,_property_2:0},__6:{count:0,_property_1:0,_property_2:0},__7:{count:0,_property_1:0,_property_2:0},__8:{count:0,_property_1:0,_property_2:0},__9:{count:0,_property_1:0,_property_2:0},_0wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_1wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_2wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_3wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_4wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}}},curterm:0,beforeterm:0,interval:void 0,timerTrace:!0,openCodes:void 0,notiMedia:void 0,syned:!1,lockLittle:function(){t.syned=!0,setTimeout(function(){t.syned=!1},1e4)},lastAnlAction:void 0,lastAnlRank:void 0,curAnlAction:["H3","H2"],getAllCodes:function(t){var e=s.Deferred(),a=layer.load(2);return s.post("cqall",{date:t},function(s){e.resolve(s),layer.close(a)},"json"),e.promise()},getCode:function(t){var e=s.Deferred();return s.post("cqhaoma",{term:t},function(s){e.resolve(s)},"json"),e.promise()},setTipsPos:function(e,a,r){if(t.timerTrace){var i=s("div[data-inx='"+e+"']"),n=s(i).offset().top,o=Math.floor(e/20),l=s(".tips[data-inx='"+o+"']").css(r),c=parseFloat(l.get(0).style.top.replace(/px/i,""));c>n&&(n=c),s(l).show().css({top:n}),a&&s(l).html(a),s("#timer").empty()}else s("#timer").html(a).css(r)},start:function(){var e=void 0,a=0,r=0,i=0,n=0,o=!1,l=new Calendar,c=new Date;t.interval=setInterval(function(){if(e=new Date,a=e.getHours(),r=e.getMinutes(),i=e.getSeconds(),23==t.curterm&&a<10)n<=1&&(c.setHours(10),c.setMinutes(0),c.setSeconds(50),n=l.dateDiff(c,e)),t.setTipsPos(t.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0));else if(o="true"==sessionStorage.getItem("loopreq"))i%2>0&&(t.setTipsPos(t.curterm,"正在同步数据..",{color:"#f183d3"}),t.getCode(t.curterm).done(function(e){if(e&&!e.warning){o=!1,t.lockLittle(),sessionStorage.setItem("loopreq",!1);var a=t.curterm+1,r=300;if(t.config.notification){t.notiMedia||(t.notiMedia=document.getElementById("audio")),t.notiMedia.play();var i=new Notification("巅峰数据: 数据已同步",{body:"期号："+a+", 号码："+e.opencode,icon:"cqssc/shiicon.ico"});i.onshow=function(){setTimeout(i.close.bind(i),8e3)}}if(120==a){r=0,clearInterval(t.interval),layer.msg("5秒后自动刷新"),s(".tips").hide();setTimeout(function(){window.location.reload()},5e3)}else t.setTipsPos(a,null,{color:"#f183d3"});var n=setTimeout(function(){t.openCodes.push(e),t.timerTrace&&t.fill(e,t.curterm,!0,!0,!0),clearTimeout(n)},r)}}));else{var m=r.toString();if(a>=22&&a<24||a>=0&&a<2)if((m.endsWith("4")||m.endsWith("5")&&i<=50)&&!t.syned||(m.endsWith("9")||m.endsWith("0")&&i<=50)&&!t.syned){if(n<=10){if(r>=55)c.setHours(a+1),c.getHours()>23&&(c=l.getCustomDate(1),c.setHours(0)),c.setMinutes(0);else{var u=0,d=parseInt(m.charAt(m.length-1));d%5!=0&&(d+=1,m.length>1&&(u=parseInt(m.charAt(0))),10==d&&(u++,d=0),m=u+""+d,c.setMinutes(parseInt(m)))}c.setSeconds(50),n=n=l.dateDiff(c,e)}t.setTipsPos(t.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else{if(n<=1){var d=parseInt(m.charAt(m.length-1));d=d<4?parseInt(1==m.length?4:m.charAt(0)+"4"):parseInt(1==m.length?9:m.charAt(0)+"9"),c.setMinutes(d),c.setSeconds(0),n=l.dateDiff(c,e)}if(n>240)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);t.setTipsPos(t.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}else if(m.toString().endsWith("9")&&!t.syned||m.toString().endsWith("0")&&i<=50&&!t.syned){if(n<=10){if(r>=59)a>23?(c=l.getCustomDate(1),c.setHours(0)):c.setHours(a+1),c.setMinutes(0);else if(1==m.length)c.setMinutes(10);else if(m.length>1&&!m.endsWith("0")){var f=parseInt(m.charAt(0));c.setMinutes(parseInt(f+1)+"0")}c.setSeconds(50),n=l.dateDiff(c,e)}t.setTipsPos(t.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else if(n<=1&&(m=1==m.length?9:parseInt(m.charAt(0)+"9"),c.setMinutes(m),c.setSeconds(0),n=l.dateDiff(c,e)),n>540)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);t.setTipsPos(t.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}},1e3)},iteration:function(s,e){for(item in t.anlycol)t.anlycol.hasOwnProperty(item)&&(item.startsWith("__")?t.anlycol[item].count=0:item.endsWith("2")?(t.anlycol[item].duizi=0,t.anlycol[item].shun=0):(t.anlycol[item].zu6=0,t.anlycol[item].zu3=0,t.anlycol[item].baozi=0));if(s&&s.length>0){s=s.reverse(),t.openCodes=s;for(var a=!1,r=0;r<s.length;r++)r==s.length-1&&(a=!0),t.fill(s[r],r,a,!1,e)}t.refPanel()},fill:function(e,a,r,i,n){t.timerTrace||n?(t.curterm++,t.curterm=t.curterm>120?0:t.curterm):t.beforeterm++;var o=s("[data-inx='"+a+"']").find(".columns");if(s(o[0]).text(e.expect.substring(e.expect.length-3)),e.opencode){for(var l=e.opencode.split(","),c=0;c<l.length;c++){s(o[1]).append('<span data-val="'+l[c]+'">'+l[c]+"</span>"),t.anlycol["__"+[l[c]]].count++;var m=t.anlycol["_"+c+"wqbsg_"];for(prop in m)m.hasOwnProperty(prop)&&(prop.endsWith([l[c]])?(m[prop].curmiss=0,m[prop].lasterm=t.timerTrace?t.curterm:t.beforeterm):(m[prop].curmiss++,m[prop].curmiss>m[prop].maxmiss&&(m[prop].maxmiss=m[prop].curmiss),t.anlycol["_"+c+"wqbsg_"][prop]=m[prop]))}var u=t.analysis(t.curAnlAction[0],l.join(""));u&&s(o[2]).css({color:u.color}).text(u.text);var d=t.analysis(t.curAnlAction[1],l.join(""));if(d&&s(o[3]).css({color:d.color}).text(d.text),t.cencus(e),i&&t.refPanel(),r){var p=Math.floor(t.curterm/20);s(".tips").each(function(t,e){parseInt(s(e).data("inx"))<p&&s(e).hide()})}}},cencus:function(s){for(var e=["Q3","Z3","H3","Q2","H2"],a=0;a<e.length;a++){var r=t.analysis(e[a],s.opencode.split(",").join(""));r.type&&t.anlycol[e[a]][r.type]++}},refPanel:function(){for(var e=new Array,a="",r=0;r<10;r++)e.push(t.anlycol["__"+r].count);e=e.sort(function(s,t){return s-t}).reverse();for(var r=0;r<10;r++){for(var i=0;i<10;i++)e[r]!=t.anlycol["__"+i].count||a.includes(i)||(a+=i);var n=e[r]/e[0]*100;s("._"+r+"progress").attr({"aria-valuenow":n}).find(".progress-meter").css("width",n+"%"),s("._"+r+"arise").text(e[r])}e=a.split("");for(var r=0;r<e.length;r++)s("._"+r+"coderow").data("val",e[r]),s("._"+r+"code").html(e[r]+"&nbsp;&nbsp;");for(var o in t.anlycol)if(t.anlycol.hasOwnProperty(o)&&!o.startsWith("_"))for(var l in t.anlycol[o])t.anlycol[o].hasOwnProperty(l)&&s("."+o+l).text(t.anlycol[o][l]);for(var r=0;r<5;r++)for(var c=t.anlycol["_"+r+"wqbsg_"],i=0;i<10;i++){var m=c["_"+i],u=s("#_missing_"+r+">.columns:eq("+(i+1)+")");s(u).find(".has-tip").attr("title","最后出现在"+m.lasterm+"期, 当前遗漏 "+m.curmiss+"期, 最大遗漏 "+m.maxmiss+"期"),s(u).find(".curMissing").text(m.curmiss),s(u).find(".maxMissing").text(m.maxmiss)}console.log(t.anlycol)},swipAnaly:function(e,a){for(var r=0;r<t.openCodes.length;r++){var i=t.openCodes[r];if(i.opencode){var n=t.analysis(e,i.opencode.split(",").join("")),o=s("[data-inx='"+r+"']").find(".columns");n&&s("AN1"==a?o[2]:o[3]).removeAttr("style").text("").css({color:n.color}).text(n.text)}}},analysis:function(s,e){var a=void 0;switch(s){case"Q3":a=t._3Analy(e.substr(0,3).split(""));break;case"Z3":a=t._3Analy(e.substr(1,3).split(""));break;case"H3":a=t._3Analy(e.substr(2,3).split(""));break;case"Q2":a=t._2Analy(e.substr(0,2).split(""));break;case"H2":a=t._2Analy(e.substr(3,2).split(""));break;case"W":a=t._1Analy(e.substr(0,1));break;case"Q":a=t._1Analy(e.substr(1,1));break;case"B":a=t._1Analy(e.substr(2,1));break;case"S":a=t._1Analy(e.substr(3,1));break;case"G":a=t._1Analy(e.substr(4,1))}return a},_3Analy:function(s){for(var t={},e=0,a=0;a<s.length;a++){for(var r=0,i=0;i<s.length;i++)a!=i&&s[a]==s[i]&&(r++,r>e&&(e=r));1==e?(t.type="zu3",t.text="组三",t.color="darkorange"):2==e?(t.type="baozi",t.text="豹子",t.color="fuchsia"):(t.type="zu6",t.text="组六",t.color="chartreuse")}return t},_2Analy:function(s){var t={};if(s[0]==s[1])t.type="duizi",t.text="对子",t.color="hotpink";else{var e=Math.abs(s[0]-s[1])||Math.abs(s[1]-s[0]);1!=e&&9!=e||(t.type="shun",t.text="连号",t.color="burlywood")}return t},_1Analy:function(s){var t={};return s=parseInt(s),t.text=s<5?"小":"大",s%2==0?(t.color="darksalmon",t.text+="双"):(t.color="palegreen",t.text+="单"),t}};t.getAllCodes().done(function(e){for(var a=s(".data-row"),r=0;r<120;r++)s(a[r]).attr("data-inx",r);e.msg?layer.alert(e.msg):(t.iteration(e,!0),e&&e.length>0&&e.length<120&&t.start()),s.post("cqcencusLast7",{},function(t,e,a){for(var r=0;r<t.length;r++){var i=s(".curcencus .cenlast"+r);s(i).find(".calendar").text(t[r].date),s(i).find(".zu6").text(t[r].zu6),s(i).find(".zu3").text(t[r].zu3),s(i).find(".baozi").text(t[r].baozi),s(i).find(".duizi").text(t[r].duizi),s(i).find(".shun").text(t[r].shun)}},"json")}),s("#header a.swdate").click(function(e){if(!s(this).hasClass("active")){if(s(".opened .data-row > .columns").empty(),s(".tips").hide(),sessionStorage.removeItem("codes"),s(this).hasClass("active"))return!1;s(this).parent().find("a").removeClass("active"),s(this).addClass("active"),s(".cus-date").text("自选"),s(".missingTitle").text(s(this).text());var a="",r=!1,i=new Calendar;switch(t.timerTrace=!1,s(this).data("val")){case"tod":t.curterm=0,t.timerTrace=!0,r=!0,a=(new Date).Format("yyyy-MM-dd");break;case"ysd":a=i.getCustomDate(-1);break;case"bysd":a=i.getCustomDate(-2)}t.getAllCodes(a).done(function(s){s.msg?layer.alert(s.msg):(t.iteration(s,r),s&&s.length>0&&s.length<120&&!t.interval&&t.start())})}}),s("#header a.killtype").click(function(e){if(s(this).hasClass("active"))return!1;var a=s("#header a.killtype.active");if(s("."+t.lastAnlRank).hasClass("active")){var r=s("."+t.lastAnlRank+":first").text();s(a).each(function(e,a){s(a).text()!=r&&(t.lastAnlAction=a)}),s("."+t.lastAnlRank).removeClass("active"),t.lastAnlRank="AN1"==t.lastAnlRank?"AN2":"AN1"}t.lastAnlAction?(s(a).each(function(s,e){if(t.lastAnlAction!=e)return t.lastAnlAction=e,!1}),t.lastAnlRank="AN1"==t.lastAnlRank?"AN2":"AN1"):(t.lastAnlAction=s(a).first(),t.lastAnlRank||(t.lastAnlRank="AN1")),s(t.lastAnlAction).removeClass("active"),s(this).addClass("active"),t.lastAnlAction=this,t.curAnlAction["AN1"==t.lastAnlRank?0:1]=s(this).data("val"),t.swipAnaly(s(this).data("val"),t.lastAnlRank);var i=s("."+t.lastAnlRank);s(i).addClass("trigger").text(s(this).text()),setTimeout(function(){s(i).removeClass("trigger")},800)}),s(".AN1,.AN2").click(function(){var e=s(this).hasClass("AN1")?"AN1":"AN2";t.lastAnlRank=e;var a="AN1"==e?"AN2":"AN1";s("."+a).removeClass("active"),s("."+e).addClass("active")}),s(".cus-date").click(function(t){s(".datepicker-here").trigger("focus")}),s("#cusdatebtn").datepicker({autoClose:!0,maxDate:new Date,onSelect:function(e,a,r){s(".cus-date").text(e).parent().find("a").removeClass("active"),s(".cus-date").addClass("active"),s(".opened .data-row > .columns").empty(),s(".tips").hide(),sessionStorage.removeItem("codes");var i=!0;e!=(new Date).Format("yyyy-MM-dd")&&(t.curterm=0,t.timerTrace=!1,i=!1),s(".missingTitle").text(e+" "),t.getAllCodes(e).done(function(s){s.msg?layer.alert(s.msg):(t.iteration(s,i),s.length<120&&!t.interval&&t.start())})}}),s("#usenotification").change(function(s){var e=void 0;e=this.checked?"已开启通知!":"已关闭通知!";var a=function(){t.notiMedia||(t.notiMedia=document.getElementById("audio")),t.notiMedia.play();var s=new Notification("巅峰数据",{body:e,icon:"cqssc/shiicon.ico"});s.onshow=function(){setTimeout(s.close.bind(s),3e3)}};window.Notification?("granted"!==Notification.permission?Notification.requestPermission(function(s){Notification.permission!==s&&(Notification.permission=s,a())}):a(),t.config.notification=this.checked):(this.checked=!1,layer.msg("您的浏览器不支持通知"))});var e=function(){s.post("cqonline",{},function(t,e,a){s("#curOnline").text(t.cur),s("#maxOnline").text(t.max)},"json")};utils.getParams("online")?setTimeout(function(){e(),s("#onlineup").click(e)},1e3):s("#online").remove(),utils.getParams("wn")&&s(".cencus > .row").mouseenter(function(t){s('.opened span[data-val="'+s(this).data("val")+'"]').addClass("active")}).mouseleave(function(t){s('.opened span[data-val="'+s(this).data("val")+'"]').removeClass("active")}),s.post("cqaddOnline",{},function(s,t,e){}),s(window).on("beforeunload",function(){console.log("cut"),s.post("cqcutOnline",{},function(s,t,e){console.log("cuted")})})});