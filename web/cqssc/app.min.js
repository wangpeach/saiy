$(document).foundation(),jQuery(document).ready(function(e){var s={config:{peak:{AM:[0,2],PM:[10,12],interval:5},usually:{times:[10,22],interval:10},notification:!1},anlycol:{Q3:{zu6:0,zu3:0,baozi:0},Z3:{zu6:0,zu3:0,baozi:0},H3:{zu6:0,zu3:0,baozi:0},Q2:{duizi:0,shun:0},H2:{duizi:0,shun:0},"__*":{count:0,_property_1:0,_property_2:0},__0:{count:0,_property_1:0,_property_2:0},__1:{count:0,_property_1:0,_property_2:0},__2:{count:0,_property_1:0,_property_2:0},__3:{count:0,_property_1:0,_property_2:0},__4:{count:0,_property_1:0,_property_2:0},__5:{count:0,_property_1:0,_property_2:0},__6:{count:0,_property_1:0,_property_2:0},__7:{count:0,_property_1:0,_property_2:0},__8:{count:0,_property_1:0,_property_2:0},__9:{count:0,_property_1:0,_property_2:0},_0wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_1wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_2wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_3wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_4wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}}},curterm:0,beforeterm:0,interval:void 0,syntime:0,synlock:!1,timerTrace:!0,openCodes:void 0,notiMedia:void 0,syned:!1,lockLittle:function(){s.syned=!0,setTimeout(function(){s.syned=!1},1e4)},lastAnlAction:void 0,lastAnlRank:void 0,curAnlAction:["H3","H2"],getAllCodes:function(s){var t=e.Deferred(),a=layer.load(2);return e.post("cqall",{date:s,clientTime:(new Date).Format("yyyy-MM-dd hh:mm:ss")},function(e){t.resolve(e),layer.close(a)},"json"),t.promise()},getCode:function(s){var t=e.Deferred();return e.post("cqhaoma",{term:s},function(e){t.resolve(e)},"json"),t.promise()},setTipsPos:function(t,a,r){if(s.timerTrace){var i=e("div[data-inx='"+t+"']"),n=e(i).offset().top,o=Math.floor(t/20),l=e(".tips[data-inx='"+o+"']").css(r),c=parseFloat(l.get(0).style.top.replace(/px/i,""));c>n&&(n=c),e(l).show().animate({top:n},500),a&&e(l).html(a),e("#timer").empty()}else e("#timer").html(a).css(r)},start:function(){var t=void 0,a=0,r=0,i=0,n=0,o=!1,l=new Calendar,c=new Date;s.interval=setInterval(function(){if(t=new Date,a=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),23==s.curterm&&a<10)n<=1&&(c.setHours(10),c.setMinutes(0),c.setSeconds(46),n=l.dateDiff(c,t)),s.setTipsPos(s.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0));else if((o="true"==sessionStorage.getItem("loopreq"))&&!s.synlock)i%2>0&&(s.setTipsPos(s.curterm,"正在同步数据..",{color:"#f183d3"}),s.synlock=!0,s.getCode(s.curterm).done(function(t){if(s.synlock=!1,t&&!t.warning){o=!1,s.lockLittle(),sessionStorage.setItem("loopreq",!1);var a=s.curterm+1,r=500;if(s.config.notification){s.notiMedia||(s.notiMedia=document.getElementById("audio")),s.notiMedia.play();var i=new Notification("巅峰数据: 数据已同步",{body:"期号："+a+", 号码："+t.opencode,icon:"cqssc/shiicon.ico"});i.onshow=function(){setTimeout(i.close.bind(i),8e3)}}if(120==a){r=0,clearInterval(s.interval),layer.msg("6秒后将清空今天的数据"),e(".tips").hide();var n=setTimeout(function(){s.init(),s.cnecusLast7(1),clearTimeout(n)},6e3)}else s.setTipsPos(a,null,{color:"#f183d3"});var l=setTimeout(function(){s.openCodes.push(t),s.timerTrace&&s.fill(t,s.curterm,!0,!0,!0),clearTimeout(l)},r)}}));else{var m=r.toString();if(a>=22&&a<=23||a>=0&&a<2)if(119==s.curterm&&console.log("last term"),(m.endsWith("4")||m.endsWith("5")&&i<=50)&&!s.syned||(m.endsWith("9")||m.endsWith("0")&&i<=50)&&!s.syned){if(n<=10){if(r>=55)c.setHours(a+1),c.getHours()>23&&(c=l.getCustomDate(1),c.setHours(0)),c.setMinutes(0);else{var u=0,d=parseInt(m.charAt(m.length-1));d%5!=0&&(d+=1,m.length>1&&(u=parseInt(m.charAt(0))),10==d&&(u++,d=0),m=u+""+d,c.setMinutes(parseInt(m)))}c.setSeconds(46),console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n=l.dateDiff(c,t)}s.setTipsPos(s.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else{if(n<=1){var d=parseInt(m.charAt(m.length-1));d=d<4?parseInt(1==m.length?4:m.charAt(0)+"4"):parseInt(1==m.length?9:m.charAt(0)+"9"),c.setMinutes(d),c.setSeconds(0),n=l.dateDiff(c,t)}if(console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n>240)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);s.setTipsPos(s.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}else if(m.toString().endsWith("9")&&!s.syned||m.toString().endsWith("0")&&i<=50&&!s.syned){if(n<=10){if(r>=59)a>23?(c=l.getCustomDate(1),c.setHours(0)):c.setHours(a+1),c.setMinutes(0);else if(1==m.length)c.setMinutes(10);else if(m.length>1&&!m.endsWith("0")){var f=parseInt(m.charAt(0));c.setMinutes(parseInt(f+1)+"0")}c.setSeconds(46),n=l.dateDiff(c,t)}console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),s.setTipsPos(s.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else if(n<=1&&(m=1==m.length?9:parseInt(m.charAt(0)+"9"),c.setMinutes(m),c.setSeconds(0),n=l.dateDiff(c,t)),console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n>540)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);s.setTipsPos(s.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}},1e3)},init:function(){e(".tips").hide(),s.beforeterm=0,s.curterm=0;for(item in s.anlycol)if(s.anlycol.hasOwnProperty(item))if(item.startsWith("__"))s.anlycol[item].count=0;else if(item.endsWith("2"))s.anlycol[item].duizi=0,s.anlycol[item].shun=0;else if(item.endsWith("wqbsg_")){s.anlycol[item]["_*"].curmiss=0,s.anlycol[item]["_*"].maxmiss=0,s.anlycol[item]["_*"].lasterm=0;for(var t=0;t<10;t++)s.anlycol[item]["_"+t].curmiss=0,s.anlycol[item]["_"+t].maxmiss=0,s.anlycol[item]["_"+t].lasterm=0}else s.anlycol[item].zu6=0,s.anlycol[item].zu3=0,s.anlycol[item].baozi=0;e(".opened [data-inx]").find(".columns").empty()},iteration:function(e,t){if(s.init(),e&&e.length>0){e=e.reverse(),s.openCodes=e;for(var a=!1,r=0;r<e.length;r++)r==e.length-1&&(a=!0),s.fill(e[r],r,a,!1,t)}s.refPanel()},fill:function(t,a,r,i,n){s.timerTrace||n?(s.curterm++,s.curterm=s.curterm>120?0:s.curterm):s.beforeterm++;var o=e("[data-inx='"+a+"']").find(".columns");if(e(o[0]).text(t.expect.substring(t.expect.length-3)),t.opencode){for(var l=t.opencode.split(","),c=0;c<l.length;c++){e(o[1]).append('<span data-val="'+l[c]+'">'+l[c]+"</span>"),s.anlycol["__"+[l[c]]].count++;var m=s.anlycol["_"+c+"wqbsg_"];for(prop in m)m.hasOwnProperty(prop)&&(prop.endsWith([l[c]])?(m[prop].curmiss=0,m[prop].lasterm=s.timerTrace?s.curterm:s.beforeterm):(m[prop].curmiss++,m[prop].curmiss>m[prop].maxmiss&&(m[prop].maxmiss=m[prop].curmiss),s.anlycol["_"+c+"wqbsg_"][prop]=m[prop]))}var u=s.analysis(s.curAnlAction[0],l.join(""));u&&e(o[2]).css({color:u.color}).text(u.text);var d=s.analysis(s.curAnlAction[1],l.join(""));if(d&&e(o[3]).css({color:d.color}).text(d.text),s.cencus(t),i&&s.refPanel(),r){var p=Math.floor(s.curterm/20);e(".tips").each(function(s,t){parseInt(e(t).data("inx"))<p&&e(t).hide()})}}},cencus:function(e){for(var t=["Q3","Z3","H3","Q2","H2"],a=0;a<t.length;a++){var r=s.analysis(t[a],e.opencode.split(",").join(""));r.type&&s.anlycol[t[a]][r.type]++}},refPanel:function(){for(var t=new Array,a="",r=0;r<10;r++)t.push(s.anlycol["__"+r].count);t=t.sort(function(e,s){return e-s}).reverse();for(var r=0;r<10;r++){for(var i=0;i<10;i++)t[r]!=s.anlycol["__"+i].count||a.includes(i)||(a+=i);var n=t[r]/t[0]*100;e("._"+r+"progress").attr({"aria-valuenow":n}).find(".progress-meter").css("width",n+"%"),e("._"+r+"arise").text(t[r])}t=a.split("");for(var r=0;r<t.length;r++)e("._"+r+"coderow").data("val",t[r]),e("._"+r+"code").html(t[r]+"&nbsp;&nbsp;");for(var o in s.anlycol)if(s.anlycol.hasOwnProperty(o)&&!o.startsWith("_"))for(var l in s.anlycol[o])s.anlycol[o].hasOwnProperty(l)&&e("."+o+l).text(s.anlycol[o][l]);for(var r=0;r<5;r++)for(var c=s.anlycol["_"+r+"wqbsg_"],i=0;i<10;i++){var m=c["_"+i],u=e("#_missing_"+r+">.columns:eq("+(i+1)+")");e(u).find(".has-tip").attr("title","最后出现在"+m.lasterm+"期, 当前遗漏 "+m.curmiss+"期, 最大遗漏 "+m.maxmiss+"期"),e(u).find(".curMissing").text(m.curmiss),e(u).find(".maxMissing").text(m.maxmiss)}console.log(s.anlycol)},swipAnaly:function(t,a){for(var r=0;r<s.openCodes.length;r++){var i=s.openCodes[r];if(i.opencode){var n=s.analysis(t,i.opencode.split(",").join("")),o=e("[data-inx='"+r+"']").find(".columns");n&&e("AN1"==a?o[2]:o[3]).removeAttr("style").text("").css({color:n.color}).text(n.text)}}},analysis:function(e,t){var a=void 0;switch(e){case"Q3":a=s._3Analy(t.substr(0,3).split(""));break;case"Z3":a=s._3Analy(t.substr(1,3).split(""));break;case"H3":a=s._3Analy(t.substr(2,3).split(""));break;case"Q2":a=s._2Analy(t.substr(0,2).split(""));break;case"H2":a=s._2Analy(t.substr(3,2).split(""));break;case"W":a=s._1Analy(t.substr(0,1));break;case"Q":a=s._1Analy(t.substr(1,1));break;case"B":a=s._1Analy(t.substr(2,1));break;case"S":a=s._1Analy(t.substr(3,1));break;case"G":a=s._1Analy(t.substr(4,1))}return a},_3Analy:function(e){for(var s={},t=0,a=0;a<e.length;a++){for(var r=0,i=0;i<e.length;i++)a!=i&&e[a]==e[i]&&(r++,r>t&&(t=r));1==t?(s.type="zu3",s.text="组三",s.color="darkorange"):2==t?(s.type="baozi",s.text="豹子",s.color="fuchsia"):(s.type="zu6",s.text="组六",s.color="chartreuse")}return s},_2Analy:function(e){var s={};if(e[0]==e[1])s.type="duizi",s.text="对子",s.color="hotpink";else{var t=Math.abs(e[0]-e[1])||Math.abs(e[1]-e[0]);1!=t&&9!=t||(s.type="shun",s.text="连号",s.color="burlywood")}return s},_1Analy:function(e){var s={};return e=parseInt(e),s.text=e<5?"小":"大",e%2==0?(s.color="darksalmon",s.text+="双"):(s.color="palegreen",s.text+="单"),s},cnecusLast7:function(s){e.post("cqcencusLast7",{reload:s},function(s,t,a){for(var r=0;r<s.length;r++){var i=e(".curcencus .cenlast"+r);e(i).find(".calendar").text(s[r].date),e(i).find(".zu6").text(s[r].zu6),e(i).find(".zu3").text(s[r].zu3),e(i).find(".baozi").text(s[r].baozi),e(i).find(".duizi").text(s[r].duizi),e(i).find(".shun").text(s[r].shun)}},"json")}};s.getAllCodes().done(function(t){for(var a=e(".data-row"),r=0;r<120;r++)e(a[r]).attr("data-inx",r);if(t.msg)layer.alert(t.msg);else{var i=parseInt(t.syntime),n=0;(i<=0||i>5)&&(n=5*Math.random()),i>0?i-=n:i=Math.abs(i)+n,s.syntime=i,s.iteration(t.codes,!0),t.codes&&t.codes.length<120&&s.start()}s.cnecusLast7(0)}),e("#header a.swdate").click(function(t){if(!e(this).hasClass("active")){if(e(".opened .data-row > .columns").empty(),e(".tips").hide(),sessionStorage.removeItem("codes"),e(this).hasClass("active"))return!1;e(this).parent().find("a").removeClass("active"),e(this).addClass("active"),e(".cus-date").text("自选"),e(".missingTitle").text(e(this).text());var a="",r=!1,i=new Calendar;switch(s.timerTrace=!1,e(this).data("val")){case"tod":s.curterm=0,s.timerTrace=!0,r=!0,a=(new Date).Format("yyyy-MM-dd");break;case"ysd":a=i.getCustomDate(-1);break;case"bysd":a=i.getCustomDate(-2)}s.getAllCodes(a).done(function(e){e.msg?layer.alert(e.msg):(s.iteration(e.codes,r),e.codes&&e.codes.length>0&&e.codes.length<120&&!s.interval&&s.start())})}}),e("#header a.killtype").click(function(t){if(e(this).hasClass("active"))return!1;var a=e("#header a.killtype.active");if(e("."+s.lastAnlRank).hasClass("active")){var r=e("."+s.lastAnlRank+":first").text();e(a).each(function(t,a){e(a).text()!=r&&(s.lastAnlAction=a)}),e("."+s.lastAnlRank).removeClass("active"),s.lastAnlRank="AN1"==s.lastAnlRank?"AN2":"AN1"}s.lastAnlAction?(e(a).each(function(e,t){if(s.lastAnlAction!=t)return s.lastAnlAction=t,!1}),s.lastAnlRank="AN1"==s.lastAnlRank?"AN2":"AN1"):(s.lastAnlAction=e(a).first(),s.lastAnlRank||(s.lastAnlRank="AN1")),e(s.lastAnlAction).removeClass("active"),e(this).addClass("active"),s.lastAnlAction=this,s.curAnlAction["AN1"==s.lastAnlRank?0:1]=e(this).data("val"),s.swipAnaly(e(this).data("val"),s.lastAnlRank);var i=e("."+s.lastAnlRank);e(i).addClass("trigger").text(e(this).text()),setTimeout(function(){e(i).removeClass("trigger")},800)}),e(".AN1,.AN2").click(function(){var t=e(this).hasClass("AN1")?"AN1":"AN2";s.lastAnlRank=t;var a="AN1"==t?"AN2":"AN1";e("."+a).removeClass("active"),e("."+t).addClass("active")}),e(".cus-date").click(function(s){e(".datepicker-here").trigger("focus")}),e("#cusdatebtn").datepicker({autoClose:!0,maxDate:new Date,onSelect:function(t,a,r){e(".cus-date").text(t).parent().find("a").removeClass("active"),e(".cus-date").addClass("active"),e(".opened .data-row > .columns").empty(),e(".tips").hide(),sessionStorage.removeItem("codes");var i=!0;t!=(new Date).Format("yyyy-MM-dd")&&(s.curterm=0,s.timerTrace=!1,i=!1),e(".missingTitle").text(t+" "),s.getAllCodes(t).done(function(e){e.msg?layer.alert(e.msg):(s.iteration(e.codes,i),e.codes.length<120&&!s.interval&&s.start())})}}),e("#usenotification").change(function(e){var t=void 0;t=this.checked?"已开启通知!":"已关闭通知!";var a=function(){s.notiMedia||(s.notiMedia=document.getElementById("audio")),s.notiMedia.play();var e=new Notification("巅峰数据",{body:t,icon:"cqssc/shiicon.ico"});e.onshow=function(){setTimeout(e.close.bind(e),3e3)}};window.Notification?("granted"!==Notification.permission?Notification.requestPermission(function(e){Notification.permission!==e&&(Notification.permission=e,a())}):a(),s.config.notification=this.checked):(this.checked=!1,layer.msg("您的浏览器不支持通知"))}),[].slice.call(document.querySelectorAll(".dr-menu")).forEach(function(e,s){var t=e.querySelector("div.dr-trigger"),a=t.querySelector("span.dr-icon-menu"),r=!1;t.addEventListener("click",function(s){r||(e.className+=" dr-menu-open",r=!0)},!1),a.addEventListener("click",function(s){if(r)return s.stopPropagation(),r=!1,e.className=e.className.replace(/\bdr-menu-open\b/,""),!1},!1)}),e(".cencus > .row").mouseenter(function(s){e('.opened span[data-val="'+e(this).data("val")+'"]').addClass("active")}).mouseleave(function(s){e('.opened span[data-val="'+e(this).data("val")+'"]').removeClass("active")});var t=function(){e.post("cqonline",{},function(s,t,a){e("#curOnline").text(s.cur),e("#maxOnline").text(s.max)},"json")};utils.getParams("online")?(t(),setInterval(function(){t()},3e3)):e("#online").remove();var a=-1;e(".dr-menu").find(".dr-tool").click(function(s){a>0&&layer.close(a),e(this).hasClass("dr-wait")&&(a=layer.msg("敬请期待.."))}),e("#startCalculate").click(function(s){e("#doublereckon .doubleterm").remove();for(var t=parseInt(e("#amount").val()),a=1,r=parseInt(e("#every").val()),i=r,n=parseInt(e("#dobule").val()),o=1;t>0;)i=r*o,t-=i,e("#doublereckon").append("<p class='doubleterm'>第"+a+"期, 倍数："+o+", 金额："+i+", 剩余："+t+"</p>"),o*=n,a++}),e("#doublereckon").on("closed.zf.reveal",function(){e("#doublereckon .doubleam").val(""),e("#doublereckon .dbdb").val(2),e("#doublereckon .doubleterm").remove()}),e(window).on("beforeunload",function(){console.log("cut"),e.post("cqcutOnline",{},function(e,s,t){console.log("cuted")})})});