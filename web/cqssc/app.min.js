$(document).foundation(),jQuery(document).ready(function(s){var e={config:{peak:{AM:[0,2],PM:[10,12],interval:5},usually:{times:[10,22],interval:10},notification:!1},anlycol:{Q3:{zu6:0,zu3:0,baozi:0},Z3:{zu6:0,zu3:0,baozi:0},H3:{zu6:0,zu3:0,baozi:0},Q2:{duizi:0,shun:0},H2:{duizi:0,shun:0},"__*":{count:0,_property_1:0,_property_2:0},__0:{count:0,_property_1:0,_property_2:0},__1:{count:0,_property_1:0,_property_2:0},__2:{count:0,_property_1:0,_property_2:0},__3:{count:0,_property_1:0,_property_2:0},__4:{count:0,_property_1:0,_property_2:0},__5:{count:0,_property_1:0,_property_2:0},__6:{count:0,_property_1:0,_property_2:0},__7:{count:0,_property_1:0,_property_2:0},__8:{count:0,_property_1:0,_property_2:0},__9:{count:0,_property_1:0,_property_2:0},_0wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_1wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_2wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_3wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}},_4wqbsg_:{"_*":{curmiss:0,maxmiss:0,lasterm:0},_0:{curmiss:0,maxmiss:0,lasterm:0},_1:{curmiss:0,maxmiss:0,lasterm:0},_2:{curmiss:0,maxmiss:0,lasterm:0},_3:{curmiss:0,maxmiss:0,lasterm:0},_4:{curmiss:0,maxmiss:0,lasterm:0},_5:{curmiss:0,maxmiss:0,lasterm:0},_6:{curmiss:0,maxmiss:0,lasterm:0},_7:{curmiss:0,maxmiss:0,lasterm:0},_8:{curmiss:0,maxmiss:0,lasterm:0},_9:{curmiss:0,maxmiss:0,lasterm:0}}},curterm:0,beforeterm:0,interval:void 0,syntime:0,timerTrace:!0,openCodes:void 0,notiMedia:void 0,syned:!1,lockLittle:function(){e.syned=!0,setTimeout(function(){e.syned=!1},1e4)},lastAnlAction:void 0,lastAnlRank:void 0,curAnlAction:["H3","H2"],getAllCodes:function(e){e||(e=(new Date).Format("yyyy-MM-dd"));var t=s.Deferred(),a=layer.load(2);return s.post("cqall",{date:e,clientTime:(new Date).Format("yyyy-MM-dd hh:mm:ss")},function(s){t.resolve(s),layer.close(a)},"json"),t.promise()},getCode:function(e){var t=s.Deferred();return s.post("cqhaoma",{term:e},function(s){t.resolve(s)},"json"),t.promise()},setTipsPos:function(t,a,r){if(e.timerTrace){var i=s("div[data-inx='"+t+"']"),n=s(i).offset().top,o=Math.floor(t/20),l=s(".tips[data-inx='"+o+"']").css(r),c=parseFloat(l.get(0).style.top.replace(/px/i,""));c>n&&(n=c),s(l).show().css({top:n}),a&&s(l).html(a),s("#timer").empty()}else s("#timer").html(a).css(r)},start:function(){var t=void 0,a=0,r=0,i=0,n=0,o=!1,l=new Calendar,c=new Date;e.interval=setInterval(function(){if(t=new Date,a=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),23==e.curterm&&a<10)n<=1&&(c.setHours(10),c.setMinutes(0),c.setSeconds(46),n=l.dateDiff(c,t)),e.setTipsPos(e.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0));else if(o="true"==sessionStorage.getItem("loopreq"))i%2>0&&(e.setTipsPos(e.curterm,"正在同步数据..",{color:"#f183d3"}),e.getCode(e.curterm).done(function(t){if(t&&!t.warning){o=!1,e.lockLittle(),sessionStorage.setItem("loopreq",!1);var a=e.curterm+1,r=300;if(e.config.notification){e.notiMedia||(e.notiMedia=document.getElementById("audio")),e.notiMedia.play();var i=new Notification("巅峰数据: 数据已同步",{body:"期号："+a+", 号码："+t.opencode,icon:"cqssc/shiicon.ico"});i.onshow=function(){setTimeout(i.close.bind(i),8e3)}}if(120==a){r=0,clearInterval(e.interval),layer.msg("6秒后自动刷新"),s(".tips").hide();setTimeout(function(){window.location.reload()},6e3)}else e.setTipsPos(a,null,{color:"#f183d3"});var n=setTimeout(function(){e.openCodes.push(t),e.timerTrace&&e.fill(t,e.curterm,!0,!0,!0),clearTimeout(n)},r)}}));else{var m=r.toString();if(a>=22&&a<=23||a>=0&&a<2)if((m.endsWith("4")||m.endsWith("5")&&i<=50)&&!e.syned||(m.endsWith("9")||m.endsWith("0")&&i<=50)&&!e.syned){if(n<=10){if(r>=55)c.setHours(a+1),c.getHours()>23&&(c=l.getCustomDate(1),c.setHours(0)),c.setMinutes(0);else{var u=0,d=parseInt(m.charAt(m.length-1));d%5!=0&&(d+=1,m.length>1&&(u=parseInt(m.charAt(0))),10==d&&(u++,d=0),m=u+""+d,c.setMinutes(parseInt(m)))}c.setSeconds(46),console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n=l.dateDiff(c,t)}e.setTipsPos(e.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else{if(n<=1){var d=parseInt(m.charAt(m.length-1));d=d<4?parseInt(1==m.length?4:m.charAt(0)+"4"):parseInt(1==m.length?9:m.charAt(0)+"9"),c.setMinutes(d),c.setSeconds(0),n=l.dateDiff(c,t)}if(console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n>240)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);e.setTipsPos(e.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}else if(m.toString().endsWith("9")&&!e.syned||m.toString().endsWith("0")&&i<=50&&!e.syned){if(n<=10){if(r>=59)a>23?(c=l.getCustomDate(1),c.setHours(0)):c.setHours(a+1),c.setMinutes(0);else if(1==m.length)c.setMinutes(10);else if(m.length>1&&!m.endsWith("0")){var f=parseInt(m.charAt(0));c.setMinutes(parseInt(f+1)+"0")}c.setSeconds(46),n=l.dateDiff(c,t)}console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),e.setTipsPos(e.curterm,"剩余开奖时间&nbsp;&nbsp;"+l.formatSeconds(n--),{color:"#f183d3"}),n<=1&&(o=!0,sessionStorage.setItem("loopreq",!0))}else if(n<=1&&(m=1==m.length?9:parseInt(m.charAt(0)+"9"),c.setMinutes(m),c.setSeconds(0),n=l.dateDiff(c,t)),console.log(c.getFullYear()+"-"+c.getMonth()+"-"+c.getDay()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()),n>540)n=0,o=!0,sessionStorage.setItem("loopreq",!0);else{var p=l.formatSeconds(n--);e.setTipsPos(e.curterm,"剩余投注时间&nbsp;&nbsp;"+p,{color:"#ffefa0"})}}},1e3)},iteration:function(s,t){e.beforeterm=0,e.curterm=0;for(item in e.anlycol)if(e.anlycol.hasOwnProperty(item))if(item.startsWith("__"))e.anlycol[item].count=0;else if(item.endsWith("2"))e.anlycol[item].duizi=0,e.anlycol[item].shun=0;else if(item.endsWith("wqbsg_")){e.anlycol[item]["_*"].curmiss=0,e.anlycol[item]["_*"].maxmiss=0,e.anlycol[item]["_*"].lasterm=0;for(var a=0;a<10;a++)e.anlycol[item]["_"+a].curmiss=0,e.anlycol[item]["_"+a].maxmiss=0,e.anlycol[item]["_"+a].lasterm=0}else e.anlycol[item].zu6=0,e.anlycol[item].zu3=0,e.anlycol[item].baozi=0;if(s&&s.length>0){s=s.reverse(),e.openCodes=s;for(var r=!1,a=0;a<s.length;a++)a==s.length-1&&(r=!0),e.fill(s[a],a,r,!1,t)}e.refPanel()},fill:function(t,a,r,i,n){e.timerTrace||n?(e.curterm++,e.curterm=e.curterm>120?0:e.curterm):e.beforeterm++;var o=s("[data-inx='"+a+"']").find(".columns");if(s(o[0]).text(t.expect.substring(t.expect.length-3)),t.opencode){for(var l=t.opencode.split(","),c=0;c<l.length;c++){s(o[1]).append('<span data-val="'+l[c]+'">'+l[c]+"</span>"),e.anlycol["__"+[l[c]]].count++;var m=e.anlycol["_"+c+"wqbsg_"];for(prop in m)m.hasOwnProperty(prop)&&(prop.endsWith([l[c]])?(m[prop].curmiss=0,m[prop].lasterm=e.timerTrace?e.curterm:e.beforeterm):(m[prop].curmiss++,m[prop].curmiss>m[prop].maxmiss&&(m[prop].maxmiss=m[prop].curmiss),e.anlycol["_"+c+"wqbsg_"][prop]=m[prop]))}var u=e.analysis(e.curAnlAction[0],l.join(""));u&&s(o[2]).css({color:u.color}).text(u.text);var d=e.analysis(e.curAnlAction[1],l.join(""));if(d&&s(o[3]).css({color:d.color}).text(d.text),e.cencus(t),i&&e.refPanel(),r){var p=Math.floor(e.curterm/20);s(".tips").each(function(e,t){parseInt(s(t).data("inx"))<p&&s(t).hide()})}}},cencus:function(s){for(var t=["Q3","Z3","H3","Q2","H2"],a=0;a<t.length;a++){var r=e.analysis(t[a],s.opencode.split(",").join(""));r.type&&e.anlycol[t[a]][r.type]++}},refPanel:function(){for(var t=new Array,a="",r=0;r<10;r++)t.push(e.anlycol["__"+r].count);t=t.sort(function(s,e){return s-e}).reverse();for(var r=0;r<10;r++){for(var i=0;i<10;i++)t[r]!=e.anlycol["__"+i].count||a.includes(i)||(a+=i);var n=t[r]/t[0]*100;s("._"+r+"progress").attr({"aria-valuenow":n}).find(".progress-meter").css("width",n+"%"),s("._"+r+"arise").text(t[r])}t=a.split("");for(var r=0;r<t.length;r++)s("._"+r+"coderow").data("val",t[r]),s("._"+r+"code").html(t[r]+"&nbsp;&nbsp;");for(var o in e.anlycol)if(e.anlycol.hasOwnProperty(o)&&!o.startsWith("_"))for(var l in e.anlycol[o])e.anlycol[o].hasOwnProperty(l)&&s("."+o+l).text(e.anlycol[o][l]);for(var r=0;r<5;r++)for(var c=e.anlycol["_"+r+"wqbsg_"],i=0;i<10;i++){var m=c["_"+i],u=s("#_missing_"+r+">.columns:eq("+(i+1)+")");s(u).find(".has-tip").attr("title","最后出现在"+m.lasterm+"期, 当前遗漏 "+m.curmiss+"期, 最大遗漏 "+m.maxmiss+"期"),s(u).find(".curMissing").text(m.curmiss),s(u).find(".maxMissing").text(m.maxmiss)}console.log(e.anlycol)},swipAnaly:function(t,a){for(var r=0;r<e.openCodes.length;r++){var i=e.openCodes[r];if(i.opencode){var n=e.analysis(t,i.opencode.split(",").join("")),o=s("[data-inx='"+r+"']").find(".columns");n&&s("AN1"==a?o[2]:o[3]).removeAttr("style").text("").css({color:n.color}).text(n.text)}}},analysis:function(s,t){var a=void 0;switch(s){case"Q3":a=e._3Analy(t.substr(0,3).split(""));break;case"Z3":a=e._3Analy(t.substr(1,3).split(""));break;case"H3":a=e._3Analy(t.substr(2,3).split(""));break;case"Q2":a=e._2Analy(t.substr(0,2).split(""));break;case"H2":a=e._2Analy(t.substr(3,2).split(""));break;case"W":a=e._1Analy(t.substr(0,1));break;case"Q":a=e._1Analy(t.substr(1,1));break;case"B":a=e._1Analy(t.substr(2,1));break;case"S":a=e._1Analy(t.substr(3,1));break;case"G":a=e._1Analy(t.substr(4,1))}return a},_3Analy:function(s){for(var e={},t=0,a=0;a<s.length;a++){for(var r=0,i=0;i<s.length;i++)a!=i&&s[a]==s[i]&&(r++,r>t&&(t=r));1==t?(e.type="zu3",e.text="组三",e.color="darkorange"):2==t?(e.type="baozi",e.text="豹子",e.color="fuchsia"):(e.type="zu6",e.text="组六",e.color="chartreuse")}return e},_2Analy:function(s){var e={};if(s[0]==s[1])e.type="duizi",e.text="对子",e.color="hotpink";else{var t=Math.abs(s[0]-s[1])||Math.abs(s[1]-s[0]);1!=t&&9!=t||(e.type="shun",e.text="连号",e.color="burlywood")}return e},_1Analy:function(s){var e={};return s=parseInt(s),e.text=s<5?"小":"大",s%2==0?(e.color="darksalmon",e.text+="双"):(e.color="palegreen",e.text+="单"),e}};e.getAllCodes().done(function(t){for(var a=s(".data-row"),r=0;r<120;r++)s(a[r]).attr("data-inx",r);if(t.msg)layer.alert(t.msg);else{var i=parseInt(t.syntime),n=0;(i<=0||i>5)&&(n=5*Math.random()),i>0?i-=n:i=Math.abs(i)+n,e.syntime=i,e.iteration(t.codes,!0),t.codes&&t.codes.length<120&&e.start()}s.post("cqcencusLast7",{},function(e,t,a){for(var r=0;r<e.length;r++){var i=s(".curcencus .cenlast"+r);s(i).find(".calendar").text(e[r].date),s(i).find(".zu6").text(e[r].zu6),s(i).find(".zu3").text(e[r].zu3),s(i).find(".baozi").text(e[r].baozi),s(i).find(".duizi").text(e[r].duizi),s(i).find(".shun").text(e[r].shun)}},"json")}),s("#header a.swdate").click(function(t){if(!s(this).hasClass("active")){if(s(".opened .data-row > .columns").empty(),s(".tips").hide(),sessionStorage.removeItem("codes"),s(this).hasClass("active"))return!1;s(this).parent().find("a").removeClass("active"),s(this).addClass("active"),s(".cus-date").text("自选"),s(".missingTitle").text(s(this).text());var a="",r=!1,i=new Calendar;switch(e.timerTrace=!1,s(this).data("val")){case"tod":e.curterm=0,e.timerTrace=!0,r=!0,a=(new Date).Format("yyyy-MM-dd");break;case"ysd":a=i.getCustomDate(-1);break;case"bysd":a=i.getCustomDate(-2)}e.getAllCodes(a).done(function(s){s.msg?layer.alert(s.msg):(e.iteration(s.codes,r),s.codes&&s.codes.length>0&&s.codes.length<120&&!e.interval&&e.start())})}}),s("#header a.killtype").click(function(t){if(s(this).hasClass("active"))return!1;var a=s("#header a.killtype.active");if(s("."+e.lastAnlRank).hasClass("active")){var r=s("."+e.lastAnlRank+":first").text();s(a).each(function(t,a){s(a).text()!=r&&(e.lastAnlAction=a)}),s("."+e.lastAnlRank).removeClass("active"),e.lastAnlRank="AN1"==e.lastAnlRank?"AN2":"AN1"}e.lastAnlAction?(s(a).each(function(s,t){if(e.lastAnlAction!=t)return e.lastAnlAction=t,!1}),e.lastAnlRank="AN1"==e.lastAnlRank?"AN2":"AN1"):(e.lastAnlAction=s(a).first(),e.lastAnlRank||(e.lastAnlRank="AN1")),s(e.lastAnlAction).removeClass("active"),s(this).addClass("active"),e.lastAnlAction=this,e.curAnlAction["AN1"==e.lastAnlRank?0:1]=s(this).data("val"),e.swipAnaly(s(this).data("val"),e.lastAnlRank);var i=s("."+e.lastAnlRank);s(i).addClass("trigger").text(s(this).text()),setTimeout(function(){s(i).removeClass("trigger")},800)}),s(".AN1,.AN2").click(function(){var t=s(this).hasClass("AN1")?"AN1":"AN2";e.lastAnlRank=t;var a="AN1"==t?"AN2":"AN1";s("."+a).removeClass("active"),s("."+t).addClass("active")}),s(".cus-date").click(function(e){s(".datepicker-here").trigger("focus")}),s("#cusdatebtn").datepicker({autoClose:!0,maxDate:new Date,onSelect:function(t,a,r){s(".cus-date").text(t).parent().find("a").removeClass("active"),s(".cus-date").addClass("active"),s(".opened .data-row > .columns").empty(),s(".tips").hide(),sessionStorage.removeItem("codes");var i=!0;t!=(new Date).Format("yyyy-MM-dd")&&(e.curterm=0,e.timerTrace=!1,i=!1),s(".missingTitle").text(t+" "),e.getAllCodes(t).done(function(s){s.msg?layer.alert(s.msg):(e.iteration(s.codes,i),s.codes.length<120&&!e.interval&&e.start())})}}),s("#usenotification").change(function(s){var t=void 0;t=this.checked?"已开启通知!":"已关闭通知!";var a=function(){e.notiMedia||(e.notiMedia=document.getElementById("audio")),e.notiMedia.play();var s=new Notification("巅峰数据",{body:t,icon:"cqssc/shiicon.ico"});s.onshow=function(){setTimeout(s.close.bind(s),3e3)}};window.Notification?("granted"!==Notification.permission?Notification.requestPermission(function(s){Notification.permission!==s&&(Notification.permission=s,a())}):a(),e.config.notification=this.checked):(this.checked=!1,layer.msg("您的浏览器不支持通知"))});var t=function(){s.post("cqonline",{},function(e,t,a){s("#curOnline").text(e.cur),s("#maxOnline").text(e.max)},"json")};utils.getParams("online")?(t(),setInterval(function(){t()},3e3)):s("#online").remove(),utils.getParams("wn")&&s(".cencus > .row").mouseenter(function(e){s('.opened span[data-val="'+s(this).data("val")+'"]').addClass("active")}).mouseleave(function(e){s('.opened span[data-val="'+s(this).data("val")+'"]').removeClass("active")})});